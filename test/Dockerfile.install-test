# Test image for installation workflows
FROM node:22-slim

# Install dependencies needed for installation testing
RUN apt-get update && \
    apt-get install -y git curl jq && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# Create a test user to simulate non-root installation
RUN useradd -m -s /bin/bash testuser

# Switch to test user
USER testuser
WORKDIR /home/testuser

# Set up npm global prefix for the test user
RUN mkdir -p ~/.npm-global && \
    npm config set prefix ~/.npm-global

# Add npm global bin to PATH
ENV PATH="/home/testuser/.npm-global/bin:${PATH}"

# Copy test script
COPY test/docker-install-tests.sh /home/testuser/docker-install-tests.sh

# Make test script executable
USER root
RUN chmod +x /home/testuser/docker-install-tests.sh
USER testuser

CMD ["/bin/bash"]
